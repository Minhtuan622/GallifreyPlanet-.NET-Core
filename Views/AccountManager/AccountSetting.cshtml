@model GallifreyPlanet.ViewModels.AccountManager.AccountManagerViewModel

<div class="container my-5">
    <h1 class="mb-4 text-center">@ViewData[index: "Title"]</h1>

    <div class="row g-4">
        <div class="col-lg-8">
            <div class="card border-0 rounded-4 overflow-hidden">
                <div class="card-body p-0">
                    <nav class="nav nav-tabs" id="nav-tab" role="tablist">
                        <button class="nav-link active" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="true">Thông tin cá nhân</button>
                        <button class="nav-link" id="nav-social-tab" data-bs-toggle="tab" data-bs-target="#nav-social" type="button" role="tab" aria-controls="nav-social" aria-selected="true">Mạng xã hội</button>
                        <button class="nav-link" id="nav-password-tab" data-bs-toggle="tab" data-bs-target="#nav-password" type="button" role="tab" aria-controls="nav-password" aria-selected="false">Đổi mật khẩu</button>
                        <button class="nav-link" id="nav-privacy-tab" data-bs-toggle="tab" data-bs-target="#nav-privacy" type="button" role="tab" aria-controls="nav-privacy" aria-selected="false">Quyền riêng tư</button>
                        <button class="nav-link" id="nav-notifications-tab" data-bs-toggle="tab" data-bs-target="#nav-notifications" type="button" role="tab" aria-controls="nav-notifications" aria-selected="false">Thông báo</button>                    </nav>
                    <div class="tab-content p-4" id="nav-tabContent">
                        <div class="tab-pane fade show active" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                            <form asp-action="EditProfile" method="post" enctype="multipart/form-data">
                                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                <div class="mb-3">
                                    <label asp-for="EditProfile!.UserName" class="form-label"></label>
                                    <input asp-for="EditProfile!.UserName" class="form-control" required disabled />
                                    <span asp-validation-for="EditProfile!.UserName" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="EditProfile!.Name" class="form-label"></label>
                                    <input asp-for="EditProfile!.Name" class="form-control" required />
                                    <span asp-validation-for="EditProfile!.Name" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="EditProfile!.Email" class="form-label"></label>
                                    <input asp-for="EditProfile!.Email" class="form-control" required />
                                    <span asp-validation-for="EditProfile!.Email" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="EditProfile!.PhoneNumber" class="form-label"></label>
                                    <input asp-for="EditProfile!.PhoneNumber" class="form-control" />
                                    <span asp-validation-for="EditProfile!.PhoneNumber" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="EditProfile!.Address" class="form-label"></label>
                                    <input asp-for="EditProfile!.Address" class="form-control" />
                                    <span asp-validation-for="EditProfile!.Address" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="EditProfile!.AvatarFile" class="form-label"></label>
                                    <input asp-for="EditProfile!.AvatarFile" type="file" class="form-control" id="avatarInput" accept="image/*" />
                                    <small class="form-text text-muted">Upload tỉ lệ 1:1 để phù hợp nhất</small>
                                    <span asp-validation-for="EditProfile!.AvatarFile" class="text-danger"></span>
                                </div>
                                @if (!string.IsNullOrEmpty(value: Model.EditProfile!.CurrentAvatar))
                                {
                                    <div class="mb-3">
                                        <img src="@Model.EditProfile!.CurrentAvatar" alt="Current Avatar" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover;" />
                                    </div>
                                }
                                <div id="avatarCropper" class="mb-3"></div>
                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="nav-social" role="tabpanel" aria-labelledby="nav-social-tab">
                            <form asp-action="UpdateSocialAccount" method="post">
                                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                <div class="mb-3">
                                    <label asp-for="SocialMedia!.PersonalWebsite" class="form-label"></label>
                                    <input asp-for="SocialMedia!.PersonalWebsite" class="form-control" />
                                    <span asp-validation-for="SocialMedia!.PersonalWebsite" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="SocialMedia!.Facebook" class="form-label"></label>
                                    <input asp-for="SocialMedia!.Facebook" class="form-control" />
                                    <span asp-validation-for="SocialMedia!.Facebook" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="SocialMedia!.Github" class="form-label"></label>
                                    <input asp-for="SocialMedia!.Github" class="form-control" />
                                    <span asp-validation-for="SocialMedia!.Github" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="SocialMedia!.Twitter" class="form-label"></label>
                                    <input asp-for="SocialMedia!.Twitter" class="form-control" />
                                    <span asp-validation-for="SocialMedia!.Twitter" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="SocialMedia!.Instagram" class="form-label"></label>
                                    <input asp-for="SocialMedia!.Instagram" class="form-control" />
                                    <span asp-validation-for="SocialMedia!.Instagram" class="text-danger"></span>
                                </div>
                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="nav-password" role="tabpanel" aria-labelledby="nav-password-tab">
                            <form asp-action="ChangePassword" method="post">
                                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                <div class="mb-3">
                                    <label asp-for="ChangePassword!.CurrentPassword" class="form-label"></label>
                                    <input asp-for="ChangePassword!.CurrentPassword" class="form-control" required />
                                    <span asp-validation-for="ChangePassword!.CurrentPassword" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="ChangePassword!.NewPassword" class="form-label"></label>
                                    <input asp-for="ChangePassword!.NewPassword" class="form-control" required />
                                    <span asp-validation-for="ChangePassword!.NewPassword" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label asp-for="ChangePassword!.ConfirmNewPassword" class="form-label"></label>
                                    <input asp-for="ChangePassword!.ConfirmNewPassword" class="form-control" required />
                                    <span asp-validation-for="ChangePassword!.ConfirmNewPassword" class="text-danger"></span>
                                </div>
                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">Đổi mật khẩu</button>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="nav-privacy" role="tabpanel" aria-labelledby="nav-privacy-tab">
                            <form asp-action="PrivacySettings" method="post">
                                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                <div class="mb-3 form-check">
                                    <input asp-for="PrivacySettings!.ShowEmail" type="checkbox" class="form-check-input" />
                                    <label asp-for="PrivacySettings!.ShowEmail" class="form-check-label"></label>
                                </div>
                                <div class="mb-3 form-check">
                                    <input asp-for="PrivacySettings!.AllowMessagesFromNonFriends" type="checkbox" class="form-check-input" />
                                    <label asp-for="PrivacySettings!.AllowMessagesFromNonFriends" class="form-check-label"></label>
                                </div>
                                <div class="mb-3 form-check">
                                    <input asp-for="PrivacySettings!.AllowAddFriend" type="checkbox" class="form-check-input" />
                                    <label asp-for="PrivacySettings!.AllowAddFriend" class="form-check-label"></label>
                                </div>
                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">Lưu cài đặt</button>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="nav-notifications" role="tabpanel" aria-labelledby="nav-notifications-tab">
                            <form asp-action="NotificationSettings" method="post">
                                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                <div class="mb-3 form-check">
                                    <input asp-for="NotificationSettings!.EmailNotifications" type="checkbox" class="form-check-input" />
                                    <label asp-for="NotificationSettings!.EmailNotifications" class="form-check-label"></label>
                                </div>
                                <div class="mb-3 form-check">
                                    <input asp-for="NotificationSettings!.PushNotifications" type="checkbox" class="form-check-input" />
                                    <label asp-for="NotificationSettings!.PushNotifications" class="form-check-label"></label>
                                </div>
                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">Lưu cài đặt</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card border-0 rounded-4 overflow-hidden mb-4">
                <div class="card-body p-4">
                    <h5 class="card-title mb-4">Liên kết tài khoản mạng xã hội</h5>
                    <div class="d-grid gap-2">
                        @if (Model.LinkedAccounts.Contains(item: "Google"))
                        {
                            <button class="btn btn-outline-danger" asp-action="UnlinkAccount" asp-route-provider="Google">
                                <i class="fab fa-google me-2"></i> Hủy liên kết Google
                            </button>
                        }
                        else
                        {
                            <button class="btn btn-outline-primary" asp-action="LinkAccount" asp-route-provider="Google">
                                <i class="fab fa-google me-2"></i> Liên kết với Google
                            </button>
                        }

                        @if (Model.LinkedAccounts.Contains(item: "Facebook"))
                        {
                            <button class="btn btn-outline-danger" asp-action="UnlinkAccount" asp-route-provider="Facebook">
                                <i class="fab fa-facebook-f me-2"></i> Hủy liên kết Facebook
                            </button>
                        }
                        else
                        {
                            <button class="btn btn-outline-primary" asp-action="LinkAccount" asp-route-provider="Facebook">
                                <i class="fab fa-facebook-f me-2"></i> Liên kết với Facebook
                            </button>
                        }
                    </div>
                </div>
            </div>
            <div class="card border-0 rounded-4 overflow-hidden">
                <div class="card-body p-4">
                    <h5 class="card-title text-danger mb-4">Xóa tài khoản</h5>
                    <p class="text-muted">Cảnh báo: Hành động này không thể hoàn tác.</p>
                    <div class="d-grid">
                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                            Xóa tài khoản
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for deleting account -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title" id="deleteAccountModalLabel">Xác nhận xóa tài khoản</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="text-danger mb-4">Bạn có chắc chắn muốn xóa tài khoản? Hành động này không thể hoàn tác.</p>
                <form asp-action="DeleteAccount" method="post">
                    <div class="mb-3">
                        <label for="password" class="form-label">Nhập mật khẩu để xác nhận:</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-danger">Xóa tài khoản</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
            font-weight: 500;
            padding: 1rem 1.5rem;
        }

        .nav-tabs .nav-link.active {
            color: #0d6efd;
            border-bottom: 2px solid #0d6efd;
        }

        .btn-outline-primary,
        .btn-outline-danger {
            transition: all 0.2s ease-in-out;
        }
    </style>
}

@section Scripts {
    <script src="~/js/account_manager.js"></script>
}